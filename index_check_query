select indrelid, ind,bar.i single_index, bar.count count_of_single_index,null as combined_indexes,null as possible_duplicates
from 
(select indrelid::regclass,array_agg(indkey)::text[] ind
from pg_index
where indexrelid::regclass::text not like 'pg_%'
group by 1 ) foo
left join lateral(
	select i,count(i) from unnest(ind) i
	where i = any(ind)
	group by i
	having count(i) > 1
) bar on true
where ind && string_to_array(replace(array_to_string( ind,','),' ',','),',')

UNION
 
select distinct indrelid, ind,null::text single_index, null::bigint no_of_count_single,baz.*
from 
(select indrelid::regclass,array_agg(indkey)::text[] ind
from pg_index
where indexrelid::regclass::text not like 'pg_%'
group by 1 ) foo
 join lateral (
	select t.k,t2.k2 from 
	( select k from unnest(ind) k
	where substring(k from '.\s.+') = k and
	ind && string_to_array(k,' ') ) t
	join lateral ( 
	  select k2 from unnest(string_to_array(t.k,' ')) k2 where t.k ~ k2 
	  ) t2 on true
	
) baz on true
order by 5




